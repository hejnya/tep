<% if @edit %>

  <%= stylesheet_link_tag 'jstoolbar.css'  %>
  <%= stylesheet_link_tag 'trac.css'  %>
  <%= javascript_include_tag 'jstoolbar/jstoolbar.js' %>
  <%= javascript_include_tag 'jstoolbar/trac.js' %>
  <%= javascript_include_tag 'jstoolbar/lang/jstoolbar-en.js' %>

   <%= form_tag({:path =>  @path}, {id: 'edit-form'})  do %>
    <%= hidden_field_tag 'version', @version %>
    <%= hidden_field_tag 'edit', '' %>
    <% if @part %>
      <%= hidden_field_tag 'part', @part %>
      <%= hidden_field_tag 'pos', @pos %>
    <% end %>
    <%# <h1>Editace souboru '<%= @path % >'</h1> %>
    <div class="btn-toolbar">
      <div class="btn-group">
       <a class="btn btn-xs btn-white btn-info" data-edit="bold" title="Bold (CtrlB)"> <i class=" ace-icon fa fa-bold"></i> </a>
       <a class="btn btn-xs btn-white btn-info" data-edit="italic" title="Italic (Ctrl+I)"> <i class=" ace-icon fa fa-italic"></i> </a>
       <a class="btn btn-xs btn-white btn-info" data-edit="strike" title="Strikethrough"> <i class=" ace-icon fa fa-strikethrough"></i> </a>
      </div>
      <div class="btn-group">
       <a class="btn btn-xs btn-white btn-info" data-edit="sub" title="subscript"> <i class=" ace-icon fa fa-subscript"></i> </a>
       <a class="btn btn-xs btn-white btn-info" data-edit="sup" title="superscript"> <i class=" ace-icon fa fa-superscript"></i> </a>
      </div>
      <div class="btn-group">
       <a class="btn btn-xs btn-white btn-info" data-edit="ol" title="math"> <i class=" ace-icon fa fa-list-ol"></i> </a>
       <a class="btn btn-xs btn-white btn-info" data-edit="ul" title="math"> <i class=" ace-icon fa fa-list-ul"></i> </a>
      </div>
      <div class="btn-group">
       <a class="btn btn-xs btn-white btn-info" data-edit="h1" title="math">h1</a>
       <a class="btn btn-xs btn-white btn-info" data-edit="h2" title="math">h2</a>
       <a class="btn btn-xs btn-white btn-info" data-edit="h3" title="math">h3</a>
      </div>
      <div class="btn-group">
       <a class="btn btn-xs btn-white btn-info" data-edit="math" title="math"> <i class=" ace-icon fa fa-dollar"></i> </a>
       <a class="btn btn-xs btn-white btn-info" data-edit="dmath" title="dmath"> <i class=" ace-icon fa fa-dollar"></i><i class=" ace-icon fa fa-dollar"></i> </a>
      </div>
      <div class="btn-group">
       <a class="btn btn-xs btn-white btn-info" data-edit="link" title="dmath"> <i class=" ace-icon fa fa-chain"></i></a>
       <a class="btn btn-xs btn-white btn-info" data-edit="image" title="dmath"> <i class=" ace-icon fa fa-image"></i></a>
      </div>
      <div class="btn-group">
       <a class="btn btn-xs btn-white btn-info" data-edit="help" data-help-url="<%= wiki_piki_path('jakna/wiki', format: 'json') %>" title="help"> <i class=" ace-icon fa fa-life-ring"></i></a>
       <a class="btn btn-xs btn-white btn-info" data-edit="icons" data-icons-url="<%= wiki_piki_path( 'jakna/ikony', format: 'json') %>" title="ikony"> <i class=" ace-icon fa fa-star"></i></a>
      </div>
      <div class="btn-group">
       <a class="editorcancel btn btn-xs btn-white btn-info" href="<%= url_for path: @path %>" title="cancel (ctrl-escape)">  <i class="fa fa-ban"></i> </a>
       <a class="btn btn-xs btn-white btn-info" data-edit="save-stay" title="save and stay (Shift-Enter)"> <i class=" ace-icon fa fa-floppy-o"></i></a>
       <a class="btn btn-xs btn-white btn-warning" data-edit="save" title="save and show (Ctrl-Enter)"> <i class=" ace-icon fa fa-floppy-o"></i></a>
       <a class="btn btn-xs btn-white btn-info" data-edit="preview" title="preview (Alt-Enter)"> <i class=" ace-icon fa fa-eye"></i></a>
      </div>
    </div>
    <div class="row">
      <div class="textarea-container col-xs-6">
        <%= text_area_tag :text, @text, style:'float:left', class: 'span9 ctrl-enter-submit', id: 'textedit', cols: 100, rows: 24%>
      </div>
      <div class="col-xs-6">
        <div style="float:left" id="preview-div"></div>
      </div>
    </div>
    <div style="clear:both"></div>
    <%= button_tag  'Zpět',   :class=>'btn',            :ico => 'fa-reply', :href => url_for(path: @path)  %>
    <%= button_tag  'Uložit', :class=>'btn btn-danger', ico: 'fa-floppy-o'  %>

     <% if false %>
      <script>
                  var toolbar = new jsToolBar(document.getElementById('textedit'));
                  <% if @giwi.help_link %>toolbar.help_link = '<%= url_for(:root) + @giwi.help_link %>'; <% end %>
                  toolbar.draw();
     </script>
    <% end %>
  <% end #form %>
  <% if @used_templates %>
    Templates:
    <ul>
    <% @used_templates.sort.each do |template,defined| %>
      <% next if template =~ /^\// %>
      <% path = ".template/" + template %>

      <li><%= link_to template, path: path %>
          <%= link_to "[edit]", path: path , edit: 'me'%> : <%= defined %>,</li>
    <% end %>
    </ul>
  <% end %>

<% else %>
  <script type="text/x-mathjax-config"> MathJax.Hub.Config({ extensions: ["jsMath2jax.js"] });</script>
  <script type="text/javascript" src="/js/MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script>
  <%#
  <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  %>



  <% if @editable || @toc %>
    <div class="pull-right">
    <% if @toc %>
      <div class='toc well sidebar-nav'>
      <%== @toc %>
      </div>
    <%end%>
    </div>
  <%end%>


  <%if @html %>
    <%== @html %>
  <%else%>
    <pre><%=@text%></pre>
  <%end%>
<%end%>



<% if ! @edit && @editable %>
  <% content_for :action_buttons do %>
    <div class="pull-right">
      <%= button_tag 'Seznam stránek', :class=>'btn btn-primary', :href => url_for(path: @path, :ls => '.'), ico: 'fa-list' %>
      <%= button_tag 'Edit', :accesskey => 'e', :class=>'btn btn-danger', :href => url_for(path: @path, :edit => 'me'), ico: 'fa-edit' %>
    </div>
  <% end %>
<% end %>

<% if @edit %>
  <% content_for :action_buttons do %>
    <div class="pull-right">
      <%= button_tag  'Zpět',   :class=>'btn',            :ico => 'fa-reply', :href => url_for(path: @path)  %>
      <%= button_tag  'Uložit', :class=>'btn btn-danger', ico: 'fa-floppy-o', :type => 'button', 'data-submit-form'=>'#edit-form'   %>
    </div>
  <% end %>
<% end %>
