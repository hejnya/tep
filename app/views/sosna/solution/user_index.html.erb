

<h1>Úlohy <%= @annual %>. ročníku, série <%= @round %></h1>

<% deadline = deadline_time @config, @round %>
<% is_current_annual = @config[:annual] == @annual %>
<% show_nahrat = is_current_annual && !deadline.nil? && deadline >=  Time.now %>
<% max_size = Rails.configuration.sosna_user_solution_max_size %>

<table class="table table-bordered">
  <tr> 
   <th>Úloha</td>
   <th>Řešení</td>
   <% if show_nahrat  %>
     <th>Nahrát</td>
   <% end %>
   <th>Opravené řešení</td>
 </tr> 
<% @problems.each do |p| %>
  <tr>
    <td><%= p.problem_no%> </td>
    <td>
      <%# FIXME:   @solutions[p.id] orig_name to title %>
      <% if @solutions[p.id].filename_orig  %>
        <%= link_to @solutions[p.id].filename_orig, :action => :download, :id => @solutions[p.id].id %>
      <% else %>
        <i>žádné řešení</i>
      <% end %>
    </td>
    <% if show_nahrat %>
       <td>  <%= form_for  @solutions[p.id], :html => {:class=> 'form-inline', :multipart => true}, :url => :sosna_solution_upload do |f|  %>
          <%= f.hidden_field :id %>
          <%= f.file_field :solution_file , :class => 'input-small', :accept => 'application/pdf', 'max-size' => max_size  %>
          <%= f.submit :class => 'btn', :value => 'Nahraj řešení ' %>
          <% end %>
       </td>
    <% end %>
    <td>
      <% sol_in_this_round_allowed   = @round <  @config[:round] %>
      <% sol_in_this_round_allowed ||= @round == @config[:round] && @config[:show_revisions] == 'yes'  %>
      <% if sol_in_this_round_allowed && @solutions[p.id].filename_corr_display %>
        <%= link_to @solutions[p.id].filename_corr_display, :action => :download_corr, :id => @solutions[p.id].id %>
      <% else %>
        <i>řešení není opravené</i>
      <% end %>
      </td>

  </tr>
<% end %>
</table>

<ul>
  <% if is_current_annual && !deadline.nil?%>
    <% if deadline >= Time.now %>
       <li>Termín odeslání je <%= deadline.strftime('%-d. %-m. %Y') %> ve 23:59.</li>
    <% else %>
       <li>Termín odeslání byl <%= deadline.strftime('%-d. %-m. %Y') %> ve 23:59.</li>
    <% end %>
  <% end %>
  <li> Nahrávej řešení menší než <%= number_to_human_size max_size %>.</li>
  <li>Soubor musí být ve formátu PDF.</li>
  <li>Pokud omylem nahraješ řešení ke špatné úloze nebo v něm najdeš později chybu, můžeš úlohu nahrát znovu (nesmí však být již po termínu odevzdání).</li>
  <li> Špatně nahraný soubor můžeš smazat i tak, že nevybereš žádný soubor a klikneš na <button class="btn btn-mini">Nahraj řešení</button>.</li>
  <li>Doporučujeme ve vlastním zájmu nahrávat řešení s takovými názvy, aby bylo poznat, o jakou úlohu se jedná (např. <code>Uloha1.pdf</code>). Není to ale nutné.</li>
</ul>
</p>
